#!/bin/bash
# kubctl-0x01
# Objective: Scale Django app in Kubernetes, verify scaling, test load, and monitor usage.

set -e  # Exit on error

DEPLOYMENT_NAME="django-app"
NAMESPACE="default"
SERVICE_NAME="django-service"
URL="http://localhost:8000"   # Change if using NodePort/Ingress

echo "ðŸ“Œ Scaling $DEPLOYMENT_NAME to 3 replicas..."
kubectl scale deployment $DEPLOYMENT_NAME --replicas=3 -n $NAMESPACE

echo "âœ… Waiting for pods to be ready..."
kubectl rollout status deployment/$DEPLOYMENT_NAME -n $NAMESPACE

echo "ðŸ“Œ Verifying running pods..."
kubectl get pods -n $NAMESPACE -o wide

echo "ðŸ“Œ Running load test with wrk..."
# Adjust duration (-d) and concurrency (-c) as needed
wrk -t4 -c100 -d30s $URL

echo "ðŸ“Œ Monitoring resource usage..."
kubectl top pods -n $NAMESPACE
